{% extends 'partials/base.html' %}
{% load static %}

{% block main %}

<style>
    body { background: #f4f6f9; }
    .card { border-radius: 16px; }
    .header-title { font-size: 2rem; font-weight: bold; }
    .summary-box { font-size: 1.2rem; font-weight: 600; }

    /* FIX CHART SIZES */
    .bar-chart-container {
        height: 350px !important;
    }

    .pie-chart-container {
        height: 350px !important;
        max-width: 350px;
        margin: 0 auto;
    }
</style>

<main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">

<div class="container py-4">

    <div class="text-center mb-4">
        <h1 class="header-title">Marania Filaments â€“ Dashboard</h1>
        <p class="text-muted">Business Overview & Insights</p>
    </div>

    <!-- SUMMARY CARDS -->
    <div class="row g-4">
        <div class="col-md-3">
            <div class="card shadow-sm p-3 text-center">
                <h5>Total Customers</h5>
                <div class="summary-box">{{ total_customers }}</div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card shadow-sm p-3 text-center">
                <h5>Total Products</h5>
                <div class="summary-box">{{ total_products }}</div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card shadow-sm p-3 text-center">
                <h5>Total Price Catalogs</h5>
                <div class="summary-box">{{ total_price_catalogs }}</div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card shadow-sm p-3 text-center">
                <h5>Total Invoices</h5>
                <div class="summary-box">{{ total_invoices }}</div>
            </div>
        </div>
    </div>

    <!-- CHARTS -->
    <div class="row mt-5 g-4">

        <!-- BAR CHART -->
        <div class="col-md-6">
            <div class="card shadow-sm p-4">
                <h5 class="mb-3">Invoices by Month</h5>
                <div class="bar-chart-container">
                    <canvas id="invoiceChart"></canvas>
                </div>
            </div>
        </div>

        <!-- PIE CHART -->
        <div class="col-md-6">
            <div class="card shadow-sm p-4">
                <h5 class="mb-3">Products per Catalog Group</h5>
                <div class="pie-chart-container">
                    <canvas id="catalogChart"></canvas>
                </div>
            </div>
        </div>

    </div>

    <!-- DATA TABLES -->
    <div class="row mt-5 g-4">
        
        <div class="col-md-6">
            <div class="card shadow-sm p-4">
                <h5 class="mb-3">Latest Customers</h5>
                
                <div class="table-responsive">
                    <table class="table table-striped table-sm">
                        <thead class="table-dark">
                            <tr>
                                <th>Code</th>
                                <th>Name</th>
                                <th>Phone</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for c in latest_customers %}
                            <tr>
                                <td>{{ c.code }}</td>
                                <td>{{ c.name }}</td>
                                <td>{{ c.phone }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

            </div>
        </div>

        <div class="col-md-6">
            <div class="card shadow-sm p-4">
                <h5 class="mb-3">Recent Invoices</h5>

                <div class="table-responsive">
                    <table class="table table-striped table-sm">
                        <thead class="table-dark">
                            <tr>
                                <th>Inv #</th>
                                <th>Date</th>
                                <th>Customer</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for i in recent_invoices %}
                            <tr>
                                <td>{{ i.invoice_number }}</td>
                                <td>{{ i.invoice_date }}</td>
                                <td>{{ i.customer_name }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

            </div>
        </div>

    </div>

</div>

</main>

<!-- CHART.JS -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>

    /* ----------- BAR CHART ----------- */
    const invoiceLabels = {{ invoice_months|safe }};
    const invoiceValues = {{ invoice_counts|safe }};

    new Chart(document.getElementById('invoiceChart'), {
        type: 'bar',
        data: {
            labels: invoiceLabels,
            datasets: [{
                label: 'Invoices',
                data: invoiceValues,
                backgroundColor: 'rgba(54,162,235,0.6)',
            }]
        },
        options: {
            maintainAspectRatio: false
        }
    });

    /* ----------- PIE CHART ----------- */
    const catalogLabels = {{ catalog_groups|safe }};
    const catalogValues = {{ catalog_group_counts|safe }};

    new Chart(document.getElementById('catalogChart'), {
        type: 'pie',
        data: {
            labels: catalogLabels,
            datasets: [{
                data: catalogValues
            }]
        },
        options: {
            maintainAspectRatio: false,
            plugins: {
                legend: { position: 'bottom' }
            }
        }
    });

</script>

{% endblock %}
